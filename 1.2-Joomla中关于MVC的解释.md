# Joomla! 中关于MVC的解释
## Introduction to MVC
MVC是一种软件设计模式，它可以用来组织代码，使业务逻辑和数据呈现分离。这种方法的前提是，如果业务逻辑被分组到一个部分，那么围绕数据的接口和用户交互可以被修改和定制，而无需重新编程业务逻辑。MVC最初是为将传统的输入、处理、输出角色映射到逻辑GUI架构而开发的。
## Model
模型是封装应用程序数据的组件的一部分。除了从模型中检索数据的例程之外，它还经常提供一些例程来管理和操作这些数据。一般来说，底层数据访问技术应该封装在模型中。这样，如果应用程序要从使用平面文件的系统中移动到使用数据库的系统中，那么模型是惟一需要更改的元素，而不是视图或控制器。
## View
视图是组件的一部分，用于以适合于交互的方式呈现模型中的数据。对于基于web的应用程序，视图通常是返回给用户的HTML页面。视图从模型中提取数据(从控制器传递给它)，并将数据输入到一个填充并呈现给用户的模板中。视图不会以任何方式导致数据被修改，它只显示从模型接收到的数据。
## Controller
控制器负责响应用户操作。在web应用程序中，用户操作通常是一个页面请求。控制器将决定用户正在做什么请求，并通过触发模型适当地操作数据并将模型传递到视图中，从而做出适当的响应。控制器不会在模型中显示数据，它只会触发模型中修改数据的方法，然后将模型传递到显示数据的视图中。

## Joomla! Component Framework Explained
在 Joomla! Framework 中，models 负责管理数据。每一个 model 中一个必须写的 function 就是 get function，它用来返回数据给请求者。举个例子，这个请求者就是下面的 `HelloWorldViewHelloWorld` 视图（view）。默认情况下，命名为 `HelloWorldModelHelloWorld` 的、位于 `site/models/helloworld.php`的 model 文件是这个视图的主要相关 model。
所以，这里我们有一些命名规范要记住，这些规范是魔法生效的前提，便于我们理解类与类之间是如何调用的。
躺在 `site/views/helloworld/view.html.php` 中的 `HelloWorldViewHelloWorld` 类会利用到躺在`site/models/helloworld.php`中的 `HelloWorldModelHelloWorld`类。

再举个例子，我们想使用一个叫`fluffy`的视图，你必须有：

1. 躺在 `site/views/fluffy/view.html.php`中的`HelloWorldViewFluffy`类
2. 躺在 `site/models/fluffy.php`中的`HelloWorldModelFluffy`类
3. Note: the actual screen of the view: `site/views/fluffy/tmpl/default.php` is required as well to make this example work.

少了上述任一规范，都会导致错误出现空白页。

## 如何访问Joomla!组件

### 访问首页
用户访问前端： `www.yoursitename.com/index.php`，可以通过nginx配置隐藏index.php;

管理员访问后台：`www.yoursitename.com/administrator/index.php`。

### 访问某组件
用户访问：`www.yoursitename.com/index.php?option=com_<component_name>`

管理员访问后台：`www.yoursitename.com/administrator/index.php?option=com_<component_name>`。

举个 HelloWorld 组件的例子：

`www.myjoomla.com/index.php?option=com_helloworld`

## 基本的MVC目录结构
Components 都放在一个指定的目录当中，即 `components`文件夹，如： `/Users/Workspace/Joomla/components/`。
那么 HelloWorld 组件就是放在 `/Users/Workspace/Joomla/components/com_helloworld`。

一个基本的组件包括以下文件：
> 每一个文件夹下都会放一个空白内容的 `index.html`，这是出于安全考虑，主要是防止索引文件夹。

1. 一个出于安全考虑的空白内容文件：`index.html`
2. 一个代表 controller 自己的 php 文件：`controller.php`
3. 一个加载 controller 类的 php 文件：`<component_name>.php`
4. 一个代表 model 自己的 php 文件 `models/<component_name>.php`
5. 另一个空白文件：`models/index.html`
6. 一个包含默认视图的 php 文件：`views/<component_name>/tmpl/default.php`
7. A xml file for adding a menu item type：`views/<component_name>/tmpl/default.xml`
8. 各个文件夹下的 `index.html`
9. 一个用来显示视图的 php 文件：`views/<component_name>/view.html.php`

以上只是基本的文件，你可以根据需要任意添加，具体看看 joomla! 自带的那些 components 就知道啦。

拿 `com_search` 举例：
```
com_search
├── controller.php
├── models
│   └── search.php
├── router.php
├── search.php
└── views
	└── search
		├── metadata.xml
		├── tmpl
		│   ├── default.php
		│   ├── default.xml
		│   ├── default_error.php
		│   ├── default_form.php
		│   └── default_results.php
		├── view.html.php
		└── view.opensearch.php
```

## JEXEC 常量
每一个 php 文件开头都须放置一串这样的代码：

``` php
<?php
defined('_JEXEC') or die;
```
防止直接访问 php 文件时可能出现的报错信息。
